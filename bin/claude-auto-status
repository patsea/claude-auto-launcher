#!/bin/bash
# Enhanced status checker with HTTP health verification
# Version: 2.0
# Last Updated: January 4, 2026

# Get script directory and source helpers
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIB_DIR="$(dirname "$SCRIPT_DIR")/lib"

# Source status helper functions
source "$LIB_DIR/status-helpers.sh"

# Print header
echo "Claude Auto Services Status"
echo ""

# Initialize counters
healthy=0
degraded=0
stopped=0

# Check each service
for port in 8001 5173 3001 3000; do
    status=$(check_service_status "$port")
    format_status_line "$port" "$status"

    # Update counters
    case "$status" in
        healthy)  ((healthy++)) ;;
        degraded) ((degraded++)) ;;
        stopped)  ((stopped++)) ;;
    esac
done

# Print summary
echo ""
echo "Summary: $healthy healthy | $degraded degraded | $stopped stopped"

# Suggest action if needed
if [ $stopped -gt 0 ] || [ $degraded -gt 0 ]; then
    echo ""
    echo "Run 'claude-auto' to restart services."
fi
